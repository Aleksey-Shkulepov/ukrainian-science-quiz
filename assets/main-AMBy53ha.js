(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();class l{constructor(){this.questions=[],this.state={index:0,score:0,total:0,partialCount:0,stats:{correct:0,wrong:0,partial:0,pending:0}},this.selectedMultiple=new Set}shuffleOptions(t){const s=t.options.map((i,e)=>({option:i,originalIndex:e})).sort(()=>Math.random()-.5);if(t.type==="multiple"){const i=t.answer.map(e=>s.findIndex(n=>n.originalIndex===e)).sort((e,n)=>e-n);return{...t,options:s.map(e=>e.option),answer:i,type:"multiple"}}else{const i=s.findIndex(e=>e.originalIndex===t.answer);return{...t,options:s.map(e=>e.option),answer:i,type:t.type||"single"}}}setQuestions(t){this.questions=t.map(s=>({...s,type:s.type||"single"})).map(s=>this.shuffleOptions(s)).sort(()=>Math.random()-.5),this.state.total=this.questions.length,this.state.index=0,this.state.score=0,this.state.partialCount=0,this.updateStats()}getCurrentQuestion(){return this.questions[this.state.index]}updateStats(){const t=this.state.score,s=this.state.partialCount,i=this.state.index-t-s,e=this.state.total-this.state.index;this.state.stats={correct:t,wrong:i,partial:s,pending:e}}answerSingle(t){const s=this.getCurrentQuestion();t===s.answer&&this.state.score++}answerMultiple(t,s){const i=t.some(o=>!s.includes(o)),e=s.every(o=>t.includes(o)),n=!i&&!e&&t.length>0;t.length===s.length&&!i?this.state.score++:n&&this.state.partialCount++}next(){this.state.index++,this.updateStats()}isFinished(){return this.state.index>=this.state.total}reset(){this.questions=this.questions.map(t=>this.shuffleOptions(t)).sort(()=>Math.random()-.5),this.state.index=0,this.state.score=0,this.state.partialCount=0,this.selectedMultiple.clear(),this.updateStats()}}class c{renderQuestion(t,s){const i=document.getElementById("question-area");i.classList.remove("fade-in"),i.classList.add("fade-out"),setTimeout(()=>{let e="",n="";t.type==="multiple"?(e=t.options.map((o,a)=>`<div class="option multiple" data-index="${a}">${o}</div>`).join(""),n='<button class="confirm-btn" disabled>Підтвердити вибір</button>'):t.type==="image"&&t.image?(e=t.options.map((o,a)=>`<div class="option" data-index="${a}">${o}</div>`).join(""),n=`<img src="${t.image}" class="question-image">`):e=t.options.map((o,a)=>`<div class="option" data-index="${a}">${o}</div>`).join(""),i.innerHTML=`
        <h3 class="question">${t.q}</h3>
        ${n}
        <div class="options">${e}</div>
        `,i.classList.remove("fade-out"),i.classList.add("fade-in"),s&&s()},220)}updateProgress(t){const{correct:s,wrong:i,partial:e,pending:n}=t.stats,o=t.total;document.querySelector(".progress-container").innerHTML=`
      <div class="progress-segment progress-correct" style="width:${s/o*100}%"></div>
      <div class="progress-segment progress-partial" style="width:${e/o*100}%"></div>
      <div class="progress-segment progress-wrong" style="width:${i/o*100}%"></div>
      <div class="progress-segment progress-pending" style="width:${n/o*100}%"></div>
    `,document.getElementById("counter").textContent=`${t.index+1} / ${t.total}`}showResult(t,s){const i=Math.round(t.score/t.total*100),e=i>=80?"Відмінно":i>=60?"Добре":"Можна краще";document.getElementById("quiz-root").innerHTML=`
      <div class="result">
        <h2>Результат: ${t.score} / ${t.total}</h2>
        <p>Процент: ${i}% — ${e}</p>
        <button class="btn" onclick="location.href='index.html'">Повернутись на головну</button>
        <button class="btn ghost" id="retryBtn">Пройти ще раз</button>
      </div>
    `,document.getElementById("retryBtn").onclick=s}showError(t){document.getElementById("question-area").innerHTML=`<p class="error">${t}</p>`}}async function d(r){const t=await fetch(`/ukrainian-science-quiz/categories/${r}.json`);if(!t.ok)throw new Error("Category not found");const s=await t.json();if(!s||!s.length)throw new Error("No questions found");return s}class u{constructor(){this.model=new l,this.view=new c,this.locked=!1}async init(t){try{const s=await d(t);this.model.setQuestions(s),this.render()}catch(s){this.view.showError(`Помилка завантаження: ${s.message}`)}}render(){const t=this.model.getCurrentQuestion();this.view.renderQuestion(t,()=>{this.bindEvents()}),this.view.updateProgress(this.model.state)}bindEvents(){document.querySelectorAll(".option").forEach(s=>{s.onclick=()=>{const i=this.model.getCurrentQuestion(),e=+s.dataset.index;if(i.type==="multiple"){s.classList.toggle("selected");const n=document.querySelector(".confirm-btn");n&&(n.disabled=document.querySelectorAll(".option.selected").length===0)}else this.onSelect(e)}});const t=document.querySelector(".confirm-btn");t&&(t.onclick=()=>this.onConfirmMultiple())}onSelect(t){if(this.locked)return;this.locked=!0;const s=this.model.getCurrentQuestion(),i=document.querySelectorAll(".option");i.forEach(e=>{e.style.pointerEvents="none",e.classList.add("disabled")}),i.forEach((e,n)=>{n===s.answer?e.classList.add("correct"):n===t&&e.classList.add("wrong")}),this.model.answerSingle(t),setTimeout(()=>this.next(),900)}onConfirmMultiple(){if(this.locked)return;this.locked=!0;const t=this.model.getCurrentQuestion(),s=[...document.querySelectorAll(".option.selected")].map(e=>+e.dataset.index),i=document.querySelectorAll(".option");i.forEach(e=>{e.style.pointerEvents="none",e.classList.add("disabled")}),i.forEach((e,n)=>{t.answer.includes(n)?e.classList.add("correct"):s.includes(n)&&e.classList.add("wrong")}),this.model.answerMultiple(s,t.answer),setTimeout(()=>this.next(),1200)}next(){this.model.next(),this.model.isFinished()?this.view.showResult(this.model.state,()=>this.retry()):this.render(),this.locked=!1}retry(){this.model.reset(),location.reload()}}document.addEventListener("DOMContentLoaded",()=>{if(!document.getElementById("quiz-root"))return;const s=new URLSearchParams(window.location.search).get("category");if(!s)return;new u().init(s)});
